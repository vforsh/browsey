<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Browsey">
  <title>Browsey</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="icon" href="/icons/icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="header">
    <button class="btn-icon" id="btn-back" aria-label="Go back">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    <div class="path-display" id="path-display">/</div>
    <div class="file-actions">
      <button class="btn-file-action" id="btn-search" aria-label="Search files">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </button>
      <button class="btn-file-action" id="btn-refresh" aria-label="Refresh">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Server Indicator (dynamic mode only) -->
  <div class="server-indicator" id="server-indicator" hidden>
    <span class="server-indicator-dot"></span>
    <span class="server-indicator-url" id="server-indicator-url"></span>
    <span class="server-indicator-change">change</span>
  </div>

  <!-- Git Status Bar -->
  <div class="git-status-bar" id="git-status-bar" hidden>
    <span class="git-icon"></span>
    <div class="git-status-content">
      <div class="git-status-primary">
        <span class="git-branch" id="git-branch"></span>
        <span class="git-state" id="git-state"></span>
      </div>
      <div class="git-status-secondary" id="git-last-commit"></div>
    </div>
    <div class="file-actions">
      <button class="btn-file-action info git-info-btn" id="git-info-btn" aria-label="Git info">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4"/>
          <path d="M12 8h.01"/>
        </svg>
      </button>
      <button class="btn-file-action git-history-btn" id="git-history-btn" aria-label="Commit history">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Git Info Modal -->
  <div class="git-modal-overlay" id="git-modal-overlay" hidden>
    <div class="git-modal">
      <div class="git-modal-header">
        <div class="git-modal-title">Git Repository</div>
        <button class="btn-icon" id="git-modal-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="git-modal-content" id="git-modal-content"></div>
    </div>
  </div>

  <main class="file-list" id="file-list">
    <div class="loading" id="loading">Loading...</div>
  </main>

  <div class="toast" id="toast" hidden></div>

  <!-- File Viewer Modal -->
  <div class="viewer-overlay" id="viewer-overlay" hidden>
    <div class="viewer-header">
      <div class="viewer-filename" id="viewer-filename"></div>
      <div class="viewer-actions">
        <button class="btn-icon" id="viewer-font-decrease" aria-label="Decrease font size" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <text x="3" y="18" font-size="16" font-weight="600" fill="currentColor">A</text>
            <text x="15" y="18" font-size="14" font-weight="600" fill="currentColor">âˆ’</text>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-font-increase" aria-label="Increase font size" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <text x="3" y="18" font-size="16" font-weight="600" fill="currentColor">A</text>
            <text x="15" y="18" font-size="14" font-weight="600" fill="currentColor">+</text>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-prev" aria-label="Previous" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-next" aria-label="Next" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-download" aria-label="Download">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="viewer-content" id="viewer-content"></div>
  </div>

  <!-- Info Modal -->
  <div class="info-overlay" id="info-overlay" hidden>
    <div class="info-modal">
      <div class="info-header">
        <div class="info-title" id="info-title">File Info</div>
        <button class="btn-icon" id="info-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="info-content" id="info-content"></div>
    </div>
  </div>

  <!-- Search Overlay -->
  <div class="search-overlay" id="search-overlay" hidden>
    <div class="search-modal">
      <div class="search-header">
        <div class="search-input-wrapper">
          <svg class="search-input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text"
                 id="search-input"
                 class="search-input"
                 placeholder="Search files..."
                 autocomplete="off"
                 spellcheck="false">
        </div>
        <button class="btn-icon" id="search-close" aria-label="Close search">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="search-results" id="search-results">
        <div class="search-hint">Type to search files...</div>
      </div>
      <div class="search-footer">
        <span class="search-shortcut"><kbd>Enter</kbd> to select</span>
        <span class="search-shortcut"><kbd>Esc</kbd> to close</span>
      </div>
    </div>
  </div>

  <!-- Git Changes Overlay -->
  <div class="git-changes-overlay" id="git-changes-overlay" hidden>
    <div class="git-changes-modal">
      <div class="git-changes-header">
        <div class="git-changes-title">Changes</div>
        <button class="btn-icon" id="git-changes-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="git-changes-content" id="git-changes-content"></div>
    </div>
  </div>

  <!-- Git History Overlay -->
  <div class="git-history-overlay" id="git-history-overlay" hidden>
    <div class="git-history-modal">
      <div class="git-history-header">
        <div class="git-history-title">Commit History</div>
        <button class="btn-icon" id="git-history-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="git-history-list" id="git-history-list"></div>
    </div>
  </div>

  <!-- Connect Screen -->
  <div class="connect-screen" id="connect-screen" hidden>
    <div class="connect-card">
      <div class="connect-logo">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
        </svg>
      </div>
      <h1 class="connect-title">Browsey</h1>
      <p class="connect-subtitle">Connect to API Server</p>
      <div class="connect-saved-container" id="connect-saved-container" hidden>
        <button class="connect-saved" id="connect-saved-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          <span id="connect-saved-url"></span>
        </button>
      </div>
      <form class="connect-form" id="connect-form">
        <input type="url"
               id="connect-input"
               class="connect-input"
               placeholder="http://192.168.1.5:4200"
               autocomplete="url"
               spellcheck="false"
               required>
        <button type="submit" class="connect-btn" id="connect-btn">Connect</button>
      </form>
      <button class="connect-scan-btn" id="connect-scan-btn" hidden>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
          <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
          <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
          <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
          <rect x="7" y="7" width="10" height="10" rx="1"/>
        </svg>
        Scan QR Code
      </button>
      <div class="connect-error" id="connect-error" hidden></div>
    </div>
  </div>

  <!-- QR Scanner Overlay -->
  <div class="qr-overlay" id="qr-overlay" hidden>
    <video class="qr-video" id="qr-video" autoplay playsinline></video>
    <div class="qr-viewfinder-mask">
      <div class="qr-viewfinder"></div>
    </div>
    <button class="qr-cancel-btn" id="qr-cancel-btn">Cancel</button>
  </div>

  <script>window.__BROWSEY_API_BASE__ = "";</script>
  <script src="/app.js"></script>
</body>
</html>

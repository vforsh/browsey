<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Browsey">
  <title>Browsey</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="icon" href="/icons/icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="header">
    <button class="btn-icon" id="btn-back" aria-label="Go back">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    <div class="path-display" id="path-display">/</div>
    <div class="file-actions">
      <button class="btn-file-action" id="btn-search" aria-label="Search files">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </button>
      <button class="btn-file-action" id="btn-settings" aria-label="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Git Status Bar -->
  <div class="git-status-bar" id="git-status-bar" hidden>
    <span class="git-icon"></span>
    <div class="git-status-content">
      <div class="git-status-primary">
        <span class="git-branch" id="git-branch"></span>
        <span class="git-state" id="git-state"></span>
      </div>
      <div class="git-status-secondary" id="git-last-commit"></div>
    </div>
    <div class="file-actions">
      <button class="btn-file-action info git-info-btn" id="git-info-btn" aria-label="Git info">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4"/>
          <path d="M12 8h.01"/>
        </svg>
      </button>
      <button class="btn-file-action git-history-btn" id="git-history-btn" aria-label="Commit history">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Git Info Modal -->
  <div class="git-modal-overlay" id="git-modal-overlay" hidden>
    <div class="git-modal">
      <div class="git-modal-header">
        <div class="git-modal-title">Git Repository</div>
        <button class="btn-icon" id="git-modal-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="git-modal-content" id="git-modal-content"></div>
    </div>
  </div>

  <div class="layout-container" id="layout-container">
    <main class="file-list" id="file-list">
      <!-- Pull to Refresh Indicator -->
      <div class="pull-refresh-indicator" id="pull-refresh-indicator">
        <svg class="pull-refresh-spinner" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke-width="2.5" fill="none" stroke="currentColor" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="loading" id="loading">Loading...</div>
    </main>
    <aside class="preview-pane" id="preview-pane" hidden>
      <div class="preview-header" id="preview-header">
        <div class="preview-filename" id="preview-filename"></div>
        <div class="preview-actions">
          <button class="btn-icon" id="preview-font-decrease" aria-label="Decrease font size" hidden>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <text x="3" y="18" font-size="16" font-weight="600" fill="currentColor">A</text>
              <text x="15" y="18" font-size="14" font-weight="600" fill="currentColor">−</text>
            </svg>
          </button>
          <button class="btn-icon" id="preview-font-increase" aria-label="Increase font size" hidden>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <text x="3" y="18" font-size="16" font-weight="600" fill="currentColor">A</text>
              <text x="15" y="18" font-size="14" font-weight="600" fill="currentColor">+</text>
            </svg>
          </button>
          <button class="btn-icon" id="preview-prev" aria-label="Previous" hidden>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 18l-6-6 6-6"/>
            </svg>
          </button>
          <button class="btn-icon" id="preview-next" aria-label="Next" hidden>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </button>
          <button class="btn-icon" id="preview-download" aria-label="Download">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </button>
          <button class="btn-icon" id="preview-close" aria-label="Close preview">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="preview-content" id="preview-content"></div>
    </aside>
  </div>

  <div class="toast" id="toast" hidden></div>

  <!-- File Viewer Modal -->
  <div class="viewer-overlay" id="viewer-overlay" hidden>
    <div class="viewer-header">
      <div class="viewer-filename" id="viewer-filename"></div>
      <div class="viewer-actions">
        <button class="btn-icon" id="viewer-font-decrease" aria-label="Decrease font size" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <text x="3" y="18" font-size="16" font-weight="600" fill="currentColor">A</text>
            <text x="15" y="18" font-size="14" font-weight="600" fill="currentColor">−</text>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-font-increase" aria-label="Increase font size" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <text x="3" y="18" font-size="16" font-weight="600" fill="currentColor">A</text>
            <text x="15" y="18" font-size="14" font-weight="600" fill="currentColor">+</text>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-prev" aria-label="Previous" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-next" aria-label="Next" hidden>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-download" aria-label="Download">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>
        <button class="btn-icon" id="viewer-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="viewer-content" id="viewer-content"></div>
  </div>

  <!-- Info Modal -->
  <div class="info-overlay" id="info-overlay" hidden>
    <div class="info-modal">
      <div class="info-header">
        <div class="info-title" id="info-title">File Info</div>
        <button class="btn-icon" id="info-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="info-content" id="info-content"></div>
      <div class="info-footer" id="info-footer" hidden></div>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <div class="confirm-overlay" id="confirm-overlay" hidden>
    <div class="confirm-modal">
      <div class="confirm-message" id="confirm-message"></div>
      <div class="confirm-actions">
        <button class="confirm-btn confirm-cancel" id="confirm-cancel">Cancel</button>
        <button class="confirm-btn confirm-danger" id="confirm-danger">Delete</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="settings-overlay" id="settings-overlay" hidden>
    <div class="settings-modal">
      <div class="settings-header">
        <div class="settings-title">Settings</div>
        <button class="btn-icon" id="settings-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="settings-content" id="settings-content"></div>
    </div>
  </div>

  <!-- Search Overlay -->
  <div class="search-overlay" id="search-overlay" hidden>
    <div class="search-modal">
      <div class="search-header">
        <div class="search-input-wrapper">
          <svg class="search-input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text"
                 id="search-input"
                 class="search-input"
                 placeholder="Search files..."
                 autocomplete="off"
                 spellcheck="false">
        </div>
        <button class="btn-icon" id="search-close" aria-label="Close search">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="search-results" id="search-results">
        <div class="search-hint">Type to search files...</div>
      </div>
      <div class="search-footer">
        <span class="search-shortcut"><kbd>Enter</kbd> to select</span>
        <span class="search-shortcut"><kbd>Esc</kbd> to close</span>
      </div>
    </div>
  </div>

  <!-- Git Changes Overlay -->
  <div class="git-changes-overlay" id="git-changes-overlay" hidden>
    <div class="git-changes-modal">
      <div class="git-changes-header">
        <div class="git-changes-title">Changes</div>
        <button class="btn-icon" id="git-changes-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="git-changes-content" id="git-changes-content"></div>
    </div>
  </div>

  <!-- Git History Overlay -->
  <div class="git-history-overlay" id="git-history-overlay" hidden>
    <div class="git-history-modal">
      <div class="git-history-header">
        <div class="git-history-title">Commit History</div>
        <button class="btn-icon" id="git-history-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="git-history-list" id="git-history-list"></div>
    </div>
  </div>

  <!-- Connect Screen -->
  <div class="connect-screen" id="connect-screen" hidden>
    <div class="connect-card">
      <div class="connect-logo">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
        </svg>
      </div>
      <h1 class="connect-title">Browsey</h1>
      <p class="connect-subtitle">Connect to API Server</p>
      <div class="connect-history" id="connect-history" hidden>
        <div class="connect-history-label">Recent servers</div>
        <ul class="connect-history-list" id="connect-history-list"></ul>
      </div>
      <form class="connect-form" id="connect-form">
        <input type="url"
               id="connect-input"
               class="connect-input"
               placeholder="http://192.168.1.5:4200"
               autocomplete="url"
               spellcheck="false"
               required>
        <button type="submit" class="connect-btn" id="connect-btn">Connect</button>
      </form>
      <button class="connect-scan-btn" id="connect-scan-btn" hidden>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
          <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
          <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
          <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
          <rect x="7" y="7" width="10" height="10" rx="1"/>
        </svg>
        Scan QR Code
      </button>
      <div class="connect-error" id="connect-error" hidden></div>
    </div>
  </div>

  <!-- QR Scanner Overlay -->
  <div class="qr-overlay" id="qr-overlay" hidden>
    <video class="qr-video" id="qr-video" autoplay playsinline></video>
    <div class="qr-viewfinder-mask">
      <div class="qr-viewfinder"></div>
    </div>
    <button class="qr-cancel-btn" id="qr-cancel-btn">Cancel</button>
  </div>

  <script>window.__BROWSEY_API_BASE__ = "";</script>
  <script src="/app.js"></script>
</body>
</html>

# План: Замена кнопки обновления на кнопку поиска

## Цель

Заменить кнопку "Refresh" в правом верхнем углу на кнопку поиска, которая позволяет искать файлы и папки в текущей директории и всех поддиректориях рекурсивно.

## Текущее состояние

### Кнопка Refresh
- **Расположение HTML**: `src/ui/index.html` (строки 21-26)
- **Обработчик**: `src/ui/app.ts` (строка 562)
- **Функционал**: Перезагружает текущую директорию через `navigate(this.currentPath)`

### Существующие API эндпоинты
- `/api/list` — список файлов директории
- `/api/file` — скачивание файла
- `/api/view` — просмотр файла
- `/api/stat` — метаданные файла

**Поиск отсутствует** — нужно реализовать с нуля.

---

## Этапы реализации

### Этап 1: Backend — API эндпоинт поиска

**Файл**: `src/routes.ts`

1. Создать новый обработчик `handleSearch()`
2. Параметры запроса:
   - `path` — начальная директория для поиска
   - `query` — поисковый запрос (подстрока в имени файла)
   - `limit` (опционально) — максимальное количество результатов (по умолчанию 100)
3. Реализовать рекурсивный обход директорий:
   - Использовать `Bun.Glob` или `fs.readdir` с опцией `recursive`
   - Применять существующие ignore-паттерны (`createIgnoreMatcher`)
   - Учитывать флаг `showHidden`
4. Применить защиту путей через `resolveSafePath()`
5. Вернуть массив найденных файлов с путями относительно `path`

**Примерный формат ответа**:
```json
{
  "results": [
    {
      "name": "config.ts",
      "path": "src/config.ts",
      "type": "file",
      "size": 1234
    }
  ],
  "truncated": false
}
```

### Этап 2: Frontend — UI компонент поиска

**Файлы**: `src/ui/index.html`, `src/ui/styles.css`, `src/ui/app.ts`

#### 2.1 Изменить кнопку в HTML

Заменить иконку refresh на иконку поиска (лупа):

```html
<button class="btn-icon" id="btn-search" aria-label="Search">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"/>
    <path d="m21 21-4.35-4.35"/>
  </svg>
</button>
```

#### 2.2 Создать модальное окно/overlay поиска

Добавить в HTML:
```html
<div id="search-overlay" class="search-overlay hidden">
  <div class="search-container">
    <input type="text" id="search-input" placeholder="Поиск файлов..." autocomplete="off">
    <button class="btn-icon" id="search-close" aria-label="Close">...</button>
  </div>
  <div id="search-results" class="search-results"></div>
</div>
```

#### 2.3 Стили для поиска

Добавить в `styles.css`:
- `.search-overlay` — полноэкранный overlay
- `.search-container` — контейнер с полем ввода
- `.search-results` — список результатов
- `.search-result-item` — отдельный результат
- Анимации появления/скрытия

#### 2.4 Логика поиска в app.ts

Создать класс `SearchManager` или добавить в `FileBrowser`:

1. **Открытие поиска**:
   - Клик по кнопке поиска
   - Показать overlay, фокус на input

2. **Выполнение поиска**:
   - Debounce (300мс) при вводе
   - Минимум 2 символа для начала поиска
   - Показать индикатор загрузки
   - Вызов `/api/search?path=...&query=...`

3. **Отображение результатов**:
   - Список с иконками файлов/папок
   - Показать относительный путь
   - Подсветить совпадение в имени

4. **Навигация по результатам**:
   - Клик — перейти к файлу/папке
   - Для файлов — открыть viewer
   - Для папок — navigate к папке

5. **Закрытие поиска**:
   - Кнопка закрытия
   - Клавиша Escape
   - Клик вне overlay

### Этап 3: Интеграция и тестирование

1. Подключить новый обработчик в `handleApiRequest()` (`src/routes.ts`)
2. Протестировать на больших директориях
3. Проверить поведение при отсутствии результатов
4. Проверить мобильную версию (touch события)
5. Проверить работу с ignore-паттернами

---

## Дополнительные улучшения (опционально)

- [ ] Горячая клавиша для поиска (Ctrl/Cmd + F или /)
- [ ] История поиска (localStorage)
- [ ] Фильтр по типу файла
- [ ] Поиск по содержимому файлов (grep-like)
- [ ] Поиск с регулярными выражениями

---

## Оценка файлов для изменения

| Файл | Тип изменения |
|------|---------------|
| `src/routes.ts` | Добавить `handleSearch()` |
| `src/ui/index.html` | Заменить кнопку, добавить overlay |
| `src/ui/styles.css` | Стили для поиска |
| `src/ui/app.ts` | Логика поиска |

---

## Зависимости

Новые зависимости не требуются. Используем:
- Bun fs API для рекурсивного обхода
- Существующую систему ignore-паттернов
- Vanilla TypeScript/JavaScript для UI
